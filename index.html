<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CodeMentor AI Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#0f1117; --panel:#1c1f2b; --panel-light:#252a3b; --accent:#4f8cff; 
  --accent-hover:#66a3ff; --text:#e8eaf0; --muted:#9aa0b3; --radius:16px; --transition:.25s ease;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{display:flex;height:100vh;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;}
.sidebar{width:260px;background:var(--panel);display:flex;flex-direction:column;padding:14px;gap:12px;overflow-y:auto;position:relative;}
.sidebar h1{font-size:20px;font-weight:600;margin-bottom:6px;}
.top-buttons{display:flex;gap:6px;margin-bottom:10px;}
.top-buttons button{flex:1;padding:10px;border:none;border-radius:var(--radius);background:var(--accent);color:white;cursor:pointer;transition:var(--transition);}
.top-buttons button:hover{background:var(--accent-hover);}
.chat-btn{background:var(--panel-light);border:none;color:var(--text);padding:12px;border-radius:var(--radius);cursor:pointer;text-align:left;transition:var(--transition);margin-bottom:4px;}
.chat-btn:hover{background:#323646;}
.chat-btn.active{background:var(--accent);color:white;}
.context-menu{position:absolute;background:var(--panel-light);border:1px solid #333;border-radius:var(--radius);display:none;flex-direction:column;z-index:1000;}
.context-menu button{padding:10px 14px;border:none;background:transparent;color:var(--text);text-align:left;cursor:pointer;transition:var(--transition);}
.context-menu button:hover{background:#323646;}
.main{flex:1;display:flex;flex-direction:column;height:100vh;position:relative;}
.chat{flex:1;padding:20px;overflow-y:auto;display:none;}
.chat.active{display:block;}
.message{max-width:75%;padding:14px 18px;border-radius:18px;margin-bottom:14px;line-height:1.6;animation:fade .3s ease forwards;word-wrap:break-word;white-space:pre-wrap;position:relative;opacity:0;transform:translateY(6px);}
.user{margin-left:auto;background:var(--accent);color:white;}
.ai{background:var(--panel-light);}
pre{background:#0b0d14;padding:14px;border-radius:12px;overflow-x:auto;margin-top:10px;font-size:14px;}
.copy{margin-top:6px;background:#323646;border:none;color:var(--text);padding:6px 10px;border-radius:8px;cursor:pointer;font-size:12px;transition:var(--transition);}
.copy:hover{background:var(--accent);color:white;}
.input-bar{padding:16px;background:linear-gradient(transparent,rgba(15,17,23,.95));}
.input-wrap{background:var(--panel);border-radius:32px;padding:8px 12px;display:flex;gap:10px;align-items:center;transition:var(--transition);}
.input-wrap input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-size:16px;}
.send{background:var(--accent);border:none;padding:10px 18px;border-radius:32px;color:white;font-weight:600;cursor:pointer;transition:var(--transition);}
.send:hover{background:var(--accent-hover);transform:scale(1.05);}
.thinking{color:var(--muted);font-size:14px;}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:800px){.sidebar{display:none}.message{max-width:90%}}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h1>CodeMentor AI Ultimate</h1>
  <div class="top-buttons">
    <button onclick="newChat()">+ New Chat</button>
  </div>
</div>

<div class="context-menu" id="contextMenu">
  <button onclick="renameSelectedChat()">Rename</button>
  <button onclick="deleteSelectedChat()">Delete</button>
</div>

<div class="main" id="main"></div>

<script>
let chatCounter=0,chats=[],activeChatId=-1,selectedChatId=null,memory={},availableVoices=[];

// --- PRELOAD VOICES ---
function loadVoices(){
    availableVoices = window.speechSynthesis.getVoices();
    if(availableVoices.length===0){
        window.speechSynthesis.onvoiceschanged = () => { availableVoices = window.speechSynthesis.getVoices(); };
    }
}
loadVoices();

// --- NEW CHAT ---
function newChat(){
  const chatId=chatCounter++;
  const chatDiv=document.createElement("div");
  chatDiv.className="chat";
  chatDiv.dataset.id=chatId;
  chatDiv.innerHTML=`
    <div class="messages"></div>
    <div class="input-bar">
      <div class="input-wrap">
        <input placeholder="Ask me anything..." id="input-${chatId}">
        <button class="send" onclick="send(${chatId})">Send</button>
      </div>
    </div>
  `;
  document.getElementById("main").appendChild(chatDiv);

  const btn=document.createElement("button");
  btn.className="chat-btn";
  btn.innerText=`Chat ${chatCounter}`;
  btn.dataset.id=chatId;
  btn.onclick=()=>switchChat(chatId);
  attachContextMenu(btn, chatId);
  document.getElementById("sidebar").appendChild(btn);

  chats.push({id:chatId,div:chatDiv,btn:btn,history:[]});
  const input=document.getElementById(`input-${chatId}`);
  input.addEventListener("keydown", e=>{if(e.key==="Enter") send(chatId)});
  switchChat(chatId);
  postAI("Hello! I am CodeMentor AI Ultimate. I solve any math problem, write advanced code with explanations, and guide you step-by-step on real-world tasks. Ask me anything!");
}

// --- CONTEXT MENU ---
const contextMenu=document.getElementById("contextMenu");
function attachContextMenu(btn, chatId){
  btn.oncontextmenu = e => { e.preventDefault(); openContextMenu(e,chatId); }
  let timer;
  btn.addEventListener("touchstart", e => {
    timer = setTimeout(()=>openContextMenu({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},chatId),500);
  });
  btn.addEventListener("touchend", e=>{clearTimeout(timer)});
  btn.addEventListener("touchmove", e=>{clearTimeout(timer)});
}

function openContextMenu(e,chatId){
  selectedChatId=chatId;
  contextMenu.style.display="flex";
  contextMenu.style.top=e.clientY+"px";
  contextMenu.style.left=e.clientX+"px";
}
document.addEventListener("click",()=>{contextMenu.style.display="none"});

function renameSelectedChat(){
  if(selectedChatId===null) return;
  const chatObj=chats.find(c=>c.id===selectedChatId);
  const newName=prompt("Enter new chat name:", chatObj.btn.innerText);
  if(newName) chatObj.btn.innerText=newName;
}

function deleteSelectedChat(){
  if(selectedChatId===null) return;
  const chatObj=chats.find(c=>c.id===selectedChatId);
  chatObj.div.remove();
  chatObj.btn.remove();
  chats=chats.filter(c=>c.id!==selectedChatId);
  if(activeChatId===selectedChatId){
    if(chats.length>0) switchChat(chats[0].id);
    else activeChatId=-1;
  }
  selectedChatId=null;
}

// --- SWITCH CHAT ---
function switchChat(id){
  chats.forEach(c=>c.div.classList.remove("active"));
  chats.forEach(c=>c.btn.classList.remove("active"));
  const chatObj=chats.find(c=>c.id===id);
  if(!chatObj) return;
  chatObj.div.classList.add("active");
  chatObj.btn.classList.add("active");
  activeChatId=id;
}

// --- MESSAGES ---
function postUser(text){
  const chatObj=chats.find(c=>c.id===activeChatId);
  chatObj.history.push({type:"user",text:text});
  const messages = chatObj.div.querySelector(".messages");
  const div=document.createElement("div");
  div.className="message user";
  div.innerText=text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function postAI(text){
  const chatObj=chats.find(c=>c.id===activeChatId);
  chatObj.history.push({type:"ai",text:text});
  const messages = chatObj.div.querySelector(".messages");

  if(text.startsWith("//") || text.includes("function") || text.includes("<html")){
    const wrap=document.createElement("div");
    wrap.className="message ai";
    const pre=document.createElement("pre");
    pre.innerText=text;

    const btnCopy=document.createElement("button");
    btnCopy.className="copy";
    btnCopy.innerText="Copy";
    btnCopy.onclick=()=>navigator.clipboard.writeText(text);

    const btnSpeak=document.createElement("button");
    btnSpeak.className="copy";
    btnSpeak.innerText="ðŸ”Š Speak";
    btnSpeak.onclick=()=>speakText(text);

    wrap.appendChild(pre);
    wrap.appendChild(btnCopy);
    wrap.appendChild(btnSpeak);
    messages.appendChild(wrap);

  }else{
    const div=document.createElement("div");
    div.className="message ai";
    div.innerText=text;

    const btnSpeak=document.createElement("button");
    btnSpeak.className="copy";
    btnSpeak.innerText="ðŸ”Š Speak";
    btnSpeak.onclick=()=>speakText(text);
    div.appendChild(btnSpeak);

    messages.appendChild(div);
  }
  messages.scrollTop = messages.scrollHeight;
}

// --- TEXT-TO-SPEECH (EMOJIS IGNORED) ---
function speakText(text){
    if('speechSynthesis' in window){
        const cleanText = text.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|[\uD83C-\uDBFF\uDC00-\uDFFF])/g,'')
                              .replace(/[:;=8][\-^']?[\)D]/g,'');

        const utter = new SpeechSynthesisUtterance(cleanText);
        utter.rate = 1;      
        utter.pitch = 1.1;   
        utter.volume = 1;    

        if(availableVoices.length > 0){
            utter.voice = availableVoices.find(v => v.lang.includes('en') && v.name.toLowerCase().includes('female')) || availableVoices[0];
        }

        window.speechSynthesis.speak(utter);
    } else {
        alert("Sorry, your browser does not support speech synthesis.");
    }
}

// --- SUPER SMART MATH ---
function solveMath(text){
  try{
    let expr=text.toLowerCase()
      .replace(/Ã—|x/g,"*")
      .replace(/Ã·/g,"/")
      .replace(/Ï€/g,"Math.PI")
      .replace(/âˆš(\d+)/g,"Math.sqrt($1)")
      .replace(/\^/g,"**")
      .replace(/sum of (\d+) and (\d+)/,"$1+$2")
      .replace(/difference of (\d+) and (\d+)/,"$1-$2")
      .replace(/product of (\d+) and (\d+)/,"$1*$2")
      .replace(/quotient of (\d+) and (\d+)/,"$1/$2");

    if(/[^0-9+\-*/().\sMathPI]/.test(expr)) return null;
    let result = Function('"use strict";return ('+expr+')')();
    if(result!==undefined) return "Step-by-step solution:\n1. Evaluate: "+expr+"\n2. Result: "+result;
  }catch(e){}
  return null;
}

// --- SEND ---
async function send(id){
  const input=document.getElementById(`input-${id}`);
  const text=input.value.trim();
  if(!text) return;
  switchChat(id);
  postUser(text);
  input.value="";
  const thinking=document.createElement("div");
  thinking.className="message ai thinking";
  thinking.innerText="Thinking...";
  chats.find(c=>c.id===id).div.querySelector(".messages").appendChild(thinking);
  chats.find(c=>c.id===id).div.querySelector(".messages").scrollTop = chats.find(c=>c.id===id).div.querySelector(".messages").scrollHeight;
  await new Promise(r=>setTimeout(r,700));
  thinking.remove();
  respond(text);
}

// --- SUPER SMART RESPONSE ---
function respond(text){
  const langText=text.toLowerCase();
  const chatObj=chats.find(c=>c.id===activeChatId);

  // Memory
  if(langText.includes("my name is")){
      memory.name = text.replace(/my name is/i,"").trim();
      postAI(`Nice to meet you, ${memory.name}!`);
      return;
  }

  // Greetings
  if(/hello|hi|hey|how are you|how's it going|good morning|good evening/i.test(text)){
      postAI("Hello! I'm doing great ðŸ˜„ How can I assist you today?");
      return;
  }

  // Guides
  if(/install python/i.test(text)){
      postAI(
        "Step-by-step to install Python on Windows 10:\n" +
        "1. Go to https://www.python.org/downloads/windows/\n" +
        "2. Click on the latest Python version download.\n" +
        "3. Run the installer and check 'Add Python to PATH'.\n" +
        "4. Click Install Now.\n" +
        "5. Open Command Prompt and type 'python --version' to check."
      );
      return;
  }

  if(/basic website/i.test(text)){
      postAI(
        "Step-by-step to make a basic website:\n" +
        "1. Create a folder on your computer.\n" +
        "2. Create an index.html file inside.\n" +
        "3. Add basic HTML structure.\n" +
        "4. Open it in a browser.\n" +
        "5. Add CSS/JS files for styling and interactivity."
      );
      return;
  }

  if(/learn javascript/i.test(text)){
      postAI(
        "Step-by-step to learn JavaScript efficiently:\n" +
        "1. Start with free tutorials: w3schools or Mozilla MDN.\n" +
        "2. Practice syntax: variables, functions, loops.\n" +
        "3. Build small projects: calculator, to-do list.\n" +
        "4. Learn DOM manipulation and events.\n" +
        "5. Explore ES6+ features and frameworks."
      );
      return;
  }

  // Math
  const mathAnswer=solveMath(text);
  if(mathAnswer){postAI(mathAnswer);return;}

  // Code request
  const codeKeywords=["code","script","function","program","javascript","python","html","css","java"];
  if(codeKeywords.some(w=>langText.includes(w))){
    const codeSamples=[
      {
        code:`// JavaScript: Advanced Calculator
class Calculator{
  add(a,b){return a+b;}
  subtract(a,b){return a-b;}
  multiply(a,b){return a*b;}
  divide(a,b){return a/b;}
}
const calc=new Calculator();
console.log(calc.add(5,3));`,
        explanation:"Step-by-step:\n1. Create Calculator class.\n2. Add methods.\n3. Create instance.\n4. Call methods and log."
      }
    ];
    const example=codeSamples[Math.floor(Math.random()*codeSamples.length)];
    postAI(example.code);
    setTimeout(()=>postAI(example.explanation),600);
    return;
  }

  // Fallback
  postAI("I am a super smart AI. I can solve math, generate advanced code, or give step-by-step guidance. Could you clarify exactly what you want?");
}

// --- INIT ---
newChat();
</script>
</body>
</html>
