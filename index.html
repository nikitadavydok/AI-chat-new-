<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Next-Level Smart AI Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#0e0f13; --panel:#151720; --panel-light:#1c1f2b; --accent:#4f8cff; 
  --accent-hover:#66a3ff; --text:#e8eaf0; --muted:#9aa0b3; --radius:16px; --transition:.25s ease;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{display:flex;height:100vh;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;}
.sidebar{width:260px;background:var(--panel);display:flex;flex-direction:column;padding:14px;gap:12px;overflow-y:auto;position:relative;}
.sidebar h1{font-size:20px;font-weight:600;margin-bottom:6px;}
.top-buttons{display:flex;gap:6px;margin-bottom:10px;}
.top-buttons button{flex:1;padding:10px;border:none;border-radius:var(--radius);background:var(--accent);color:white;cursor:pointer;transition:var(--transition);}
.top-buttons button:hover{background:var(--accent-hover);}
.chat-btn{background:var(--panel-light);border:none;color:var(--text);padding:12px;border-radius:var(--radius);cursor:pointer;text-align:left;transition:var(--transition);margin-bottom:4px;}
.chat-btn:hover{background:#23263a;}
.chat-btn.active{background:var(--accent);color:white;}
.context-menu{position:absolute;background:var(--panel-light);border:1px solid #333;border-radius:var(--radius);display:none;flex-direction:column;z-index:1000;}
.context-menu button{padding:10px 14px;border:none;background:transparent;color:var(--text);text-align:left;cursor:pointer;transition:var(--transition);}
.context-menu button:hover{background:#23263a;}
.main{flex:1;display:flex;flex-direction:column;height:100vh;position:relative;}
.chat{flex:1;padding:20px;overflow-y:auto;display:none;}
.chat.active{display:block;}
.message{max-width:75%;padding:14px 18px;border-radius:18px;margin-bottom:14px;line-height:1.6;animation:fade var(--transition) ease;word-wrap:break-word;white-space:pre-wrap;position:relative;}
.user{margin-left:auto;background:var(--accent);color:white;}
.ai{background:var(--panel-light);}
pre{background:#0b0d14;padding:14px;border-radius:12px;overflow-x:auto;margin-top:10px;font-size:14px;}
.copy{margin-top:6px;background:#23263a;border:none;color:var(--text);padding:6px 10px;border-radius:8px;cursor:pointer;font-size:12px;transition:var(--transition);}
.copy:hover{background:var(--accent);color:white;}
.input-bar{padding:16px;background:linear-gradient(transparent,rgba(14,15,19,.95));}
.input-wrap{background:var(--panel);border-radius:32px;padding:8px 12px;display:flex;gap:10px;align-items:center;transition:var(--transition);}
.input-wrap input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-size:16px;}
.send{background:var(--accent);border:none;padding:10px 18px;border-radius:32px;color:white;font-weight:600;cursor:pointer;transition:var(--transition);}
.send:hover{background:var(--accent-hover);transform:scale(1.05);}
.thinking{color:var(--muted);font-size:14px;}
@keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1}}
@media(max-width:800px){.sidebar{display:none}.message{max-width:90%}}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h1>Next-Level AI</h1>
  <div class="top-buttons">
    <button onclick="newChat()">+ New Chat</button>
  </div>
</div>

<div class="context-menu" id="contextMenu">
  <button onclick="renameSelectedChat()">Rename</button>
  <button onclick="deleteSelectedChat()">Delete</button>
</div>

<div class="main" id="main"></div>

<script>
let chatCounter=0,chats=[],activeChatId=-1,selectedChatId=null,memory={};
const contextMenu=document.getElementById("contextMenu");

// --- NEW CHAT ---
function newChat(){
  const chatId=chatCounter++;
  const chatDiv=document.createElement("div");
  chatDiv.className="chat";
  chatDiv.dataset.id=chatId;
  chatDiv.innerHTML=`
    <div class="messages"></div>
    <div class="input-bar">
      <div class="input-wrap">
        <input placeholder="Ask me anything..." id="input-${chatId}">
        <button class="send" onclick="send(${chatId})">Send</button>
      </div>
    </div>
  `;
  document.getElementById("main").appendChild(chatDiv);

  const btn=document.createElement("button");
  btn.className="chat-btn";
  btn.innerText=`Chat ${chatCounter}`;
  btn.dataset.id=chatId;
  btn.onclick=()=>switchChat(chatId);
  attachContextMenu(btn, chatId);
  document.getElementById("sidebar").appendChild(btn);

  chats.push({id:chatId,div:chatDiv,btn:btn,history:[]});
  const input=document.getElementById(`input-${chatId}`);
  input.addEventListener("keydown", e=>{if(e.key==="Enter") send(chatId)});
  switchChat(chatId);
  postAI("Hello! I am your ultra-smart AI. Ask me anything, and I’ll guide you step by step!");
}

// --- CONTEXT MENU ---
function attachContextMenu(btn, chatId){
  btn.oncontextmenu = e => { e.preventDefault(); openContextMenu(e,chatId); }
  let timer;
  btn.addEventListener("touchstart", e => {
    timer = setTimeout(()=>openContextMenu({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},chatId),500);
  });
  btn.addEventListener("touchend", e=>{clearTimeout(timer)});
  btn.addEventListener("touchmove", e=>{clearTimeout(timer)});
}

function openContextMenu(e,chatId){
  selectedChatId=chatId;
  contextMenu.style.display="flex";
  contextMenu.style.top=e.clientY+"px";
  contextMenu.style.left=e.clientX+"px";
}
document.addEventListener("click",()=>{contextMenu.style.display="none"});

function renameSelectedChat(){
  if(selectedChatId===null) return;
  const chatObj=chats.find(c=>c.id===selectedChatId);
  const newName=prompt("Enter new chat name:", chatObj.btn.innerText);
  if(newName) chatObj.btn.innerText=newName;
}

function deleteSelectedChat(){
  if(selectedChatId===null) return;
  const chatObj=chats.find(c=>c.id===selectedChatId);
  chatObj.div.remove();
  chatObj.btn.remove();
  chats=chats.filter(c=>c.id!==selectedChatId);
  if(activeChatId===selectedChatId){
    if(chats.length>0) switchChat(chats[0].id);
    else activeChatId=-1;
  }
  selectedChatId=null;
}

// --- SWITCH CHAT ---
function switchChat(id){
  chats.forEach(c=>c.div.classList.remove("active"));
  chats.forEach(c=>c.btn.classList.remove("active"));
  const chatObj=chats.find(c=>c.id===id);
  if(!chatObj) return;
  chatObj.div.classList.add("active");
  chatObj.btn.classList.add("active");
  activeChatId=id;
}

// --- MESSAGES ---
function postUser(text){
  const chatObj=chats.find(c=>c.id===activeChatId);
  chatObj.history.push({type:"user",text:text});
  const messages = chatObj.div.querySelector(".messages");
  const div=document.createElement("div");
  div.className="message user";
  div.innerText=text;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}

function postAI(text){
  const chatObj=chats.find(c=>c.id===activeChatId);
  chatObj.history.push({type:"ai",text:text});
  const messages = chatObj.div.querySelector(".messages");
  if(text.startsWith("//") || text.includes("function") || text.includes("<html")){
    const wrap=document.createElement("div");
    wrap.className="message ai";
    const pre=document.createElement("pre");
    pre.innerText=text;
    const btn=document.createElement("button");
    btn.className="copy";
    btn.innerText="Copy";
    btn.onclick=()=>navigator.clipboard.writeText(text);
    wrap.appendChild(pre);
    wrap.appendChild(btn);
    messages.appendChild(wrap);
  }else{
    const div=document.createElement("div");
    div.className="message ai";
    div.innerText=text;
    messages.appendChild(div);
  }
  messages.scrollTop = messages.scrollHeight;
}

// --- SEND ---
async function send(id){
  const input=document.getElementById(`input-${id}`);
  const text=input.value.trim();
  if(!text) return;
  switchChat(id);
  postUser(text);
  input.value="";
  const thinking=document.createElement("div");
  thinking.className="message ai thinking";
  thinking.innerText="Thinking...";
  chats.find(c=>c.id===id).div.querySelector(".messages").appendChild(thinking);
  chats.find(c=>c.id===id).div.querySelector(".messages").scrollTop = chats.find(c=>c.id===id).div.querySelector(".messages").scrollHeight;
  await new Promise(r=>setTimeout(r,700));
  thinking.remove();
  respond(text);
}

// --- ULTRA-SMART RESPONSE ---
function respond(text){
  const langText=text.toLowerCase();
  const chatObj=chats.find(c=>c.id===activeChatId);

  // Personalized memory
  if(langText.includes("my name is")){
      memory.name = text.replace(/my name is/i,"").trim();
      postAI(`Nice to meet you, ${memory.name}!`);
      return;
  }

  // Greetings
  if(/hello|hi|hey/.test(langText)){
      postAI("Hello! I can solve problems, write code, or guide you step by step through any process.");
      return;
  }

  // Detect vague questions
  const codeWords=["code","script","function","program"];
  const mathWords=["calculate","sum","factorial","equation","solve"];
  const guideWords=["how","install","setup","download","where","step","tutorial"];
  const ambiguous=![...codeWords,...mathWords,...guideWords].some(w=>langText.includes(w));

  if(ambiguous){
      postAI("I want to help! Do you want me to write code, solve a math problem, or give a step-by-step guide?");
      return;
  }

  // Math
  try{
    let mathText=text.replace(/×|x/g,"*").replace(/÷/g,"/");
    if(/^[0-9+*/().\s-]+$/.test(mathText)){
        postAI("Math result: "+eval(mathText));
        return;
    }
  }catch{}

  // Step-by-step guides
  if(guideWords.some(w=>langText.includes(w))){
    const steps=[
      "Step 1: Research what you need to do.",
      "Step 2: Follow official or trusted guides.",
      "Step 3: Execute each step carefully.",
      "Step 4: Test and verify each step.",
      "Step 5: Ask me for clarification if needed."
    ];
    steps.forEach((s,i)=>setTimeout(()=>postAI(s),(i+1)*600));
    return;
  }

  // Code generation
  if(codeWords.some(w=>langText.includes(w))){
    const examples=[
      {
        code:`// Advanced JS: Calculator class
class Calculator{
  add(a,b){return a+b;}
  subtract(a,b){return a-b;}
  multiply(a,b){return a*b;}
  divide(a,b){return a/b;}
}
const calc=new Calculator();
console.log(calc.add(5,3));`,
        explanation:"Step-by-step:\n1. Define Calculator class.\n2. Add methods for add, subtract, multiply, divide.\n3. Instantiate object.\n4. Call method and log result."
      },
      {
        code:`// HTML/CSS/JS mini app\n<!DOCTYPE html><html><head><style>body{background:#222;color:#fff}</style></head><body><button onclick="alert('Hello!')">Click Me</button></body></html>`,
        explanation:"Step-by-step:\n1. Basic HTML structure.\n2. Style body background and color.\n3. Add button with onclick alert."
      }
    ];
    const example=examples[Math.floor(Math.random()*examples.length)];
    postAI(example.code);
    setTimeout(()=>postAI(example.explanation),600);
    return;
  }

  postAI("I can generate complex code, solve math, or guide you step by step. Could you clarify what you want?");
}

// --- INIT ---
newChat();
</script>
</body>
</html>
